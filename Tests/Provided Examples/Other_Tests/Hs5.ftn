      SUBROUTINE SETUP
      COMMON/CB04/ACC1,ACC2,IFLAG
      COMMON/CB05/NSET,ISET,NSTEP,ISTEP
      COMMON/CB06/C1,C2,C3,C4,C5,C6,C7,VINV,EINV,VSTART,VEND
      COMMON/CB10/VAQ(100,10),EAQ(100,10),QAQ(100,10),XAQ(100),LIMAQ
      COMMON/CB11/VSL(100,10),ESL(100,10),QSL(100,10),XSL(100),LIMSL,
     XXSLLOC,XMAXSL
      COMMON/CB12/VSI(100,10),ESI(100,10),QSI(100,10),XSI(100),LIMSI,
     XXSILOC,XMAXSI
      COMMON/CB15/IPTR,POSSVA(2,100),LPOSVA
      COMMON/CB22/DCSLMX,BETAMX,SNAMX,C0MX,X0ALMX,X0SIMX,DMX,
     XVBMX,CM0MX,SNDMX
      COMMON/CB23/DCSLMN,BETAMN,SNAMN,C0MN,X0ALMN,X0SIMN,DMN,
     XVBMN,CM0MN,SNDMN
C      ROUTINE TO PERFORM PROGRAM INITIALISATION
C      NUMBER OF CONTOURS TO DRAW
      NSET=10
C      NUMBER OF POINTS ON EACH CHECKPLOT
      NSTEP=2500
C      BODGE ISTEP. IT AIN'T USED, AND IT COCKS UP THE JOURNAL
      ISTEP=0
C      SET UP SIZE OF SOLUTION BUFFER
      LPOSVA=100
C      REQUIRED ACCURACY TO TERMINATE PRIMARY (OUTER)
C      ITERATION TO CLOSE VOLTAGE LOOP
      ACC1=0.001
      ACC1=0.000001
      ACC1=1.0E-8
      ACC1=1.0E-10
      ACC1=1.0E-13
C      REQUIRED ACCURACY TO TERMINATE SECONDARY (INNER)
C      ITERATION TO CLOSE VOLTAGE LOOP
      ACC2=0.001
      ACC2=0.000001
      ACC2=1.0E-8
      ACC2=1.0E-10
      ACC2=1.0E-13
C      SET UP SIZE OF DATA ARRAYS TO HOLF FIELD, VOLTAGE
C      AND CHARGE PROFILES
C      AQEOUS PHASE
      LIMAQ=100
C      SURFACE LAYER
      LIMSL=100
C      SILICON
      LIMSI=100
C      SET UP PHYSICAL CONSTANTS
      CALL SETPHY
C      SET UP PARAMETER LISTS
      CALL SETPAR
C      SET UP OUTPUT GRAPHICS
      CALL SETGRA
C      START VOLTAGE FOR OUTER ITERATION
      VSTART=-0.1
      VSTART=-0.075
      VSTART=-0.2
      VSTART=-0.05
      VSTART=-0.1
      VEND=0.1
      VSTART=-0.01
      VEND=0.01
      VEND=-0.01
      VSTART=0.01
C      WRITE VSTART, VEND AND NUMBER OF CHECKPOINTS TO CHANNEL 2
C      SO THEY CAN BE PICKED UP BY SALVAGE PROGRAM
      WRITE(2,2000)VSTART,VEND,NSTEP
2000  FORMAT(2(1X,1PE15.8),1X,I6)
      RETURN
      END
C
C******
C
C
      SUBROUTINE SETGRA
      COMMON/CB03/LTITLE(11),ITITLE(6,11),Y1,Y2,X1,X2,X3,X4,X5,
     XDASH,SIZE
C      ROUTINE TO INITIALISE GRAPHICS
      DATA ITITLE(1, 1)/4HSILI/,ITITLE(2, 1)/4HCON /
      DATA ITITLE(3, 1)/4H    /,ITITLE(4, 1)/4H    /
      DATA ITITLE(5, 1)/4H    /,ITITLE(6, 1)/4H    /
      DATA ITITLE(1, 2)/4HCOMP/,ITITLE(2, 2)/4HOUND/
      DATA ITITLE(3, 2)/4H INS/,ITITLE(4, 2)/4HULAT/
      DATA ITITLE(5, 2)/4HOR  /,ITITLE(6, 2)/4H    /
      DATA ITITLE(1, 3)/4HSURF/,ITITLE(2, 3)/4HACE /
      DATA ITITLE(3, 3)/4HLAYE/,ITITLE(4, 3)/4HR   /
      DATA ITITLE(5, 3)/4H    /,ITITLE(6, 3)/4H    /
      DATA ITITLE(1, 4)/4HSOLU/,ITITLE(2, 4)/4HTION/
      DATA ITITLE(3, 4)/4H    /,ITITLE(4, 4)/4H    /
      DATA ITITLE(5, 4)/4H    /,ITITLE(6, 4)/4H    /
      DATA ITITLE(1, 5)/4HVOLT/,ITITLE(2, 5)/4HAGE /
      DATA ITITLE(3, 5)/4H(V) /,ITITLE(4, 5)/4H    /
      DATA ITITLE(5, 5)/4H    /,ITITLE(6, 5)/4H    /
      DATA ITITLE(1, 6)/4HELEC/,ITITLE(2, 6)/4HTRIC/
      DATA ITITLE(3, 6)/4H FIE/,ITITLE(4, 6)/4HLD (/
      DATA ITITLE(5, 6)/4HV UM/,ITITLE(6, 6)/4H-1) /
      DATA ITITLE(1, 7)/4HCHAR/,ITITLE(2, 7)/4HGE D/
      DATA ITITLE(3, 7)/4HENSI/,ITITLE(4, 7)/4HTY (/
      DATA ITITLE(5, 7)/4HUC U/,ITITLE(6, 7)/4HM-3)/
      DATA ITITLE(1, 8)/4HMICR/,ITITLE(2, 8)/4HONS /
      DATA ITITLE(3, 8)/4H    /,ITITLE(4, 8)/4H    /
      DATA ITITLE(5, 8)/4H    /,ITITLE(6, 8)/4H    /
      DATA ITITLE(1, 9)/4H    /,ITITLE(2, 9)/4H    /
      DATA ITITLE(3, 9)/4H    /,ITITLE(4, 9)/4H    /
      DATA ITITLE(5, 9)/4H    /,ITITLE(6, 9)/4H    /
      DATA ITITLE(1,10)/4HV(GA/,ITITLE(2,10)/4HTE) /
      DATA ITITLE(3,10)/4H=   /,ITITLE(4,10)/4H    /
      DATA ITITLE(5,10)/4H    /,ITITLE(6,10)/4H    /
      DATA ITITLE(1,11)/4HINVE/,ITITLE(2,11)/4HRSIO/
      DATA ITITLE(3,11)/4HN   /,ITITLE(4,11)/4H    /
      DATA ITITLE(5,11)/4H    /,ITITLE(6,11)/4H    /
      DATA LTITLE/7,18,13,8,11,23,24,7,0,9,9/
C      OPEN GRAPHICS ON CHANNEL 8
      CALL PLOTS(0,0,8)
C      MOVE PEN TO INITIAL POSITION, AND ESTABLISH NEW ORIGIN
      CALL PLOT(5.0,5.0,-3)
C      GRAPH HEIGHT
      Y1=25.0
C      SILICON AXIS
      X1=6.0
C      GATE AXIS
      X2=7.0
C      INSULATOR SURFACE
      X3=8.0
C      AQUEOUS INTERFACE
      X4=23.0
C      TOTAL LENGTH OF PLOT
      X5=38.0
C      HEIGHT OF TITLES ABOVE UPPER AXIS
      Y2=Y1+0.5
C      INVERSION ARROW LENGTH
      LINVAR=1.0
C      LENGTH OF DASHES
      DASH=0.5
C      CHARACTER SIZE
      SIZE=0.5
      RETURN
      END
C
C******
C
C
      FUNCTION GETX(XA,XB,IADR)
      COMMON/CB03/LTITLE(11),ITITLE(6,11),Y1,Y2,X1,X2,X3,X4,X5,
     XDASH,SIZE
C      FUNCTION TO RETURN START POSITION OF CHARACTER TITLE
C      CENTERED BETWEEN XA AND XB, AND HELD IN THE ELEMENT
C      IADR OF ITITLE
      GETX=0.5*(XA+XB-(FLOAT(LTITLE(IADR))*SIZE))
      RETURN
      END
C
C******
C
C
      SUBROUTINE SETMTH
      COMMON/CB01/DCSL(10),BETA(10),SNA(10),C0(10),X0ALO(10),
     XX0SIO(10),D(10),VB(10),CM0(10),SND(10)
      COMMON/CB02/Q,DC0,DCSI,DCALO,DCSIO,CCI,DCAQ0
      COMMON/CB05/NSET,ISET,NSTEP,ISTEP
      COMMON/CB06/C1,C2,C3,C4,C5,C6,C7,VINV,EINV,VSTART,VEND
      COMMON/CB13/C8,C9,C10,C11,C12,C13,C14,C15,C16,C17,C18,C19,C20,C21
      COMMON/CB17/TOTUAQ,TOTUSL,TOTUSI,UMIN,UTOT
      COMMON/CB22/DCSLMX,BETAMX,SNAMX,C0MX,X0ALMX,X0SIMX,DMX,
     XVBMX,CM0MX,SNDMX
      COMMON/CB23/DCSLMN,BETAMN,SNAMN,C0MN,X0ALMN,X0SIMN,DMN,
     XVBMN,CM0MN,SNDMN
C      ROUTINE TO SET UP MATHEMATICAL CONSTANTS THAT ARE ONLY
C      A FUNCTION OF ISET, TO AVOID MULTIPLE RECALCULATION
C      DURING NUMERICAL ITERATIONS LATER.
C      RESET MINIMUM ENERGY TO ARBITRARILY HIGH VALUE
      UMIN=1.0E74
      C1=(8.0*C0(ISET)*Q)/(BETA(ISET)*DC0*DCAQ0)
      IF(C1.LT.0.0)CALL PANIC(8)
      C1=SQRT(C1)
      C2=DCAQ0/DCSL(ISET)
      C3=(2.0*Q*CM0(ISET))/(DC0*DCSL(ISET))
      C4=(2.0*Q*CM0(ISET))/(DC0*DCSL(ISET)*BETA(ISET))
C      HOLE CONCENTRATION IN SUBSTRATE
      A=SNA(ISET)-SND(ISET)
      CPP0=0.5*(A+SQRT((A*A)+(4.0*CCI*CCI)))
C      SO CONCENTRATION OF ELECTRONS IN SUBSTRATE
      CNP0=(CCI*CCI)/CPP0
C      DEBYE LENGTH
      DEBLEN=(2.0*DCSI)/(Q*CPP0*BETA(ISET))
      DEBLEN=SQRT(DEBLEN)
      C5=2.0/(BETA(ISET)*DEBLEN)
      C6=CNP0/CPP0
C      SILICON SURFACE INVERSION VOLTAGE
      VINV=(2.0/BETA(ISET))*LOG(SNA(ISET)/CCI)
C      CORRESPONDING INVERSION SURFACE FIELD
      EINV=-C5*H(VINV*BETA(ISET),C6)
      C7=SQRT((BETA(ISET)*C0(ISET)*Q)/(2.0*DC0*DCAQ0))
      C8=2.0/BETA(ISET)
      C9=SQRT((8.0*C0(ISET)*Q)/(BETA(ISET)*DC0*DCAQ0))
      C10=-2.0*C0(ISET)*Q
      C11=2.0*C0(ISET)*Q*DC0*DCAQ0/BETA(ISET)
      IF(C11.LT.0.0)CALL PANIC(13)
      C11=(4.0/BETA(ISET))*SQRT(C11)
      C12=(8.0*Q*CM0(ISET))/(BETA(ISET)*BETA(ISET)*DC0*DCSL(ISET))
      C13=Q*CM0(ISET)
C      CALCULATE MAXIMUM DEPLETION WIDTH, MAXIMUM EXCURSION OF
C      INTEREST IN AQUEOUS PHASE, AND MAX SURFACE LAYER WIDTH
C      DISTANCE IN SILICON
C      CALCULATE DISTANCE REQUIRED TO TRAVEL INTO THE BULK
C      SOLUTION BEFORE PROFILES DECAY
C      ATTENUATION FACTOR (IE FACTOR BY WHICH PROFILE DECAYS
C      BEFORE WE LOSE INTEREST)
      AF=100.0
C      SO LONGEST PROFILE IN THE SET:
C      (SEE NOTES 'COMPUTATIONAL BODGES 1')
      XMAXAQ=SQRT((DC0*DCAQ0)/(2.0*C0MN*BETAMN*Q))
      XMAXAQ=XMAXAQ*LOG(AF/4.0)
C      SO X-INCREMENT
      C14=XMAXAQ
      C14=C14*3.0
      C15=SQRT((2.0*DC0*DCSI)/(Q*SNAMN))
C      SURFACE LAYER WIDTH
      C16=DMX
      RETURN
      END
C
C******
C
C
